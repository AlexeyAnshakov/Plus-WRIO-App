<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>


<template id="plus-template">
    <ul class="nav navbar-nav" id="nav-accordion"></ul>
</template>
<template id="plus-plus-template">
    <li class="new panel active"><a href="#element4" data-parent="#nav-accordion" data-toggle="collapse">
        <span class="glyphicon glyphicon-plus"></span></a>
        <div class="collapse" id="element4"></div>
    </li>
</template>

<script>
    (function ($) {
        var webrunes = window.webrunes || {};
        var href = window.location.href;
        var importDoc = document.currentScript.ownerDocument;

        var template = importDoc.querySelector('#plus-template');
        var $template = $(template.innerHTML);
        var plus = importDoc.querySelector('#plus-plus-template');
        var $plus = $(plus.innerHTML);

        var proto = Object.create(HTMLElement.prototype);
        proto.createdCallback = function () {
            var self = this;
            var url = webrunes.plusUrl;
            if(url){
                this.getArticleListJsonLd(url, function (model) {
                    if (model && model.language) {
                        $.each(model.language, function (ind, item) {
                            var $li = $('<li><a href="#" class="pull-right"><span class="glyphicon glyphicon-remove btn btn-xs pull-right"></span></a></li>');
                            var $a = $('<a href="' + item.url + '"></a>').html(item.name);
                            $($li).append($a);
                            $($template).append($li);
                            if (item.url == href) {
                                $($li).addClass('active');
                            }
                        });

                        $($template).append($($plus));
                        self.innerHTML = $template.get(0).outerHTML;
                    }
                });
            }

        };
        proto.getArticleListJsonLd = function (urlList, callback) {
            $.get(urlList).success(function (response) {
                var $frame = $('<iframe id = "12345" style="display: none;"></iframe>');
                $('body').append($frame);
                var doc = $frame.get(0).contentWindow.document;
                doc.write(response);
                var json = $(doc).find('script[type="application/ld+json"]').html();
                $($frame).remove();

                if (json) json = JSON.parse(json);
                if (callback) callback(json);
            }).error(function () {
                if (callback) callback('');
            });
        };
        document.registerElement('plus-widget', {prototype: proto});
    })(jQuery);
</script>