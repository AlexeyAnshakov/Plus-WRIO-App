<link rel="import" href="http://wrio.s3-website-us-east-1.amazonaws.com/jquery.html">
<link rel="import" href="http://wrio.s3-website-us-east-1.amazonaws.com/handlebars.html">

<script>
    (function($){
        var source  = '<ul class="nav navbar-nav">{{#each language}}<li {{#if isSelected}}class="active"{{/if}}><a href="{{url}}">{{name}}</a></li>{{/each}}</ul>';

        var proto = Object.create(HTMLElement.prototype);
        proto.createdCallback = function() {
            var self = this;
            var href = window.location.href;
            this.getListWidgetTemplate(function(data){
                $.each(data.language, function(ind, lang){
                    lang.isSelected = lang.url == href;
                });
                var template = Handlebars.compile(source);
                var $html = template(data);
                self.innerHTML = $html;
            });
        };

        proto.getListWidgetTemplate = function(callback){
            var self = this;
            $.get('http://fope.github.io/1WJyH1k7-list.html').success(function(response){
                var $frame = $('<iframe id = "12345" style="display: none;"></iframe>');
                $('body').append($frame);
                var doc = $frame.get(0).contentWindow.document;
                doc.write(response);
                var json = $(doc).find('script[type="application/ld+json"]').html();
                if(json) json = JSON.parse(json);
                if(callback) callback(json);
            }).error(function(){
                        if(callback) callback('');
                    });
        };

        document.registerElement('webrunes-article-list-widget', {prototype: proto});
    })(jQuery);
</script>